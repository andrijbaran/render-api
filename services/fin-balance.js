const balanceArticle = {
  1000: "Нематеріальні активи",
  1001: "первісна вартість",
  1002: "накопична амортизація",
  1005: "Незавершені капітальні інвестиції",
  1010: "Основні засоби",
  1011: "первісна вартість",
  1012: "знос",
  1015: "Інвестиційна нерухомість",
  1020: "Довгострокові біологічні активи",
  1030: "Довгострокові фінансові інвестиції: які обліковуються за методом участі в капіталі інших підприємств",
  1035: "Довгострокові фінансові інвестиції: інші фінансові інвестиції",
  1040: "Довгострокова дебіторська заборгованість",
  1045: "Відстрочені податкові активи",
  1090: "Інші необоротні активи",
  1095: "I. Необоротні активи: Усього за розділом I",
  1100: "Запаси",
  1110: "Поточні біологічні активи",
  1125: "Дебіторська заборгованість за продукцію, товари, роботи, послуги",
  1130: "Дебіторська заборгованість за розрахунками: за виданими авансами",
  1135: "Дебіторська заборгованість за розрахунками: з бюджетом",
  1136: "у тому числі з податку на прибуток",
  1155: "Інша поточна дебіторська заборгованість",
  1160: "Поточні фінансові інвестиції",
  1165: "Гроші та їх еквіваленти",
  1170: "Витрати майбутніх періодів",
  1190: "Інші оборотні активи",
  1195: "II. Оборотні активи: Усього за розділом II",
  1200: "III. Необоротні активи, утримувані для продажу, та групи вибуття",
  1300: "Баланс: АКТИВ",
  1400: "Зареєстрований (пайовий) капітал",
  1405: "Капітал у дооцінках",
  1410: "Додатковий капітал",
  1415: "Резервний капітал",
  1420: "Нерозподілений прибуток (непокритий збиток)",
  1425: "Неоплачений капітал",
  1430: "Вилучений капітал",
  1495: "I. Власний капітал: Усього за розділом I",
  1500: "Відстрочені податкові зобов'язання",
  1510: "Довгострокові кредити банків",
  1515: "Інші довгострокові зобов'язання",
  1520: "Довгострокові забезпечення",
  1525: "Цільове фінансування",
  1595: "Усього за розділом II",
  1600: "Короткострокові кредити банків",
  1610: "Поточна кредиторська заборгованість за: довгостроковими зобов'язаннями",
  1615: "Поточна кредиторська заборгованість за: товари, роботи, послуги",
  1620: "розрахунками з бюджетом",
  1621: "у тому числі з податку на прибуток",
  1625: "розрахунками зі страхування",
  1630: "розрахунками з оплати праці",
  1660: "Поточні забезпечення",
  1665: "Доходи майбутніх періодів",
  1690: "Інші поточні зобов'язання",
  1695: "III. Поточні зобов'язання: Усього за розділом IІІ",
  1700: "ІV. Зобов'язання, пов'язані з необоротними активами, \nутримуваними для продажу, та групами вибуття",
  1900: "Баланс: ПАСИВ",
  2000: "Чистий дохід від реалізації продукції (товарів, робіт, послуг)",
  2050: "Собівартість реалізованої продукції (товарів, робіт, послуг)",
  2090: "Валовий: прибуток",
  2095: "Валовий: збиток",
  2120: "Інші операційні доходи",
  2130: "Адміністративні витрати",
  2150: "Витрати на збут",
  2160: "Інші доходи",
  2165: "Інші витрати",
  2180: "Інші операційні витрати",
  2190: "Фінансовий результат від операційної діяльності:  прибуток",
  2195: "Фінансовий результат від операційної діяльності:  збиток",
  2200: "Дохід від участі в капіталі",
  2220: "Інші фінансові доходи",
  2240: "Інші доходи",
  2250: "Фінансові витрати",
  2255: "Втрати від участі в капіталі",
  2270: "Інші витрати",
  2280: "Разом доходи (2000 + 2160)",
  2285: "Разом витрати (2050 + 2165)",
  2290: "Фінансовий результат до оподаткування:  прибуток",
  2295: "Фінансовий результат до оподаткування: збиток",
  2300: "Витрати (дохід) з податку на прибуток",
  2310: "Витрати (доходи), які зменшують (збільшують) фінансовий результат після оподаткування",
  2305: "Прибуток (збиток) від припиненої діяльності після оподаткування",
  2350: "Чистий фінансовий результат: прибуток",
  2355: "Чистий фінансовий результат: збиток",
  2400: "Дооцінка (уцінка) необоротних активів",
  2405: "Дооцінка (уцінка) фінансових інструментів",
  2410: "Накопичені курсові різниці",
  2415: "Частка іншого сукупного доходу асоційованих та спільних підприємств",
  2445: "Інший сукупний дохід",
  2450: "Інший сукупний дохід до оподаткування",
  2455: "Податок на прибуток, пов'язаний з іншим сукупним доходом",
  2460: "Інший сукупний дохід після оподаткування",
  2465: "Сукупний дохід (сума рядків 2350, 2355 та 2460)",
  2500: "Матеріальні затрати",
  2505: "Витрати на оплату праці",
  2510: "Відрахування на соціальні заходи",
  2515: "Амортизація",
  2520: "Інші операційні витрати",
  2550: "Разом: III. ЕЛЕМЕНТИ ОПЕРАЦІЙНИХ ВИТРАТ",
  2600: "Середньорічна кількість простих акцій",
  2605: "Скоригована середньорічна кількість простих акцій",
  2610: "Чистий прибуток (збиток) на одну просту акцію",
  2615: "Скоригований чистий прибуток (збиток) на одну просту акцію",
  2650: "Дивіденди на одну просту акцію",
};

class BalanceFormatter {
  constructor(financialData, articles = balanceArticle) {
    this.data = financialData;
    this.articles = articles;
  }

  /**
   * Отримує значення для конкретного рядка
   * @param {number} rowCode - код рядка (наприклад, 1000)
   * @param {number} period - період (3 або 4 для поточного та попереднього року)
   * @returns {number} - значення показника
   */
  getValue(rowCode, period) {
    const key = `R${rowCode}G${period}`;
    return this.data[key] || 0;
  }

  /**
   * Формує рядок балансу
   * @param {number} rowCode - код рядка
   * @returns {Array} - масив [код, назва, поточний період, попередній період]
   */
  formatRow(rowCode) {
    const articleName = this.articles[rowCode] || "";
    const currentValue = this.getValue(rowCode, 3);
    const previousValue = this.getValue(rowCode, 4);
    
    return [
      rowCode.toString(),
      articleName,
      currentValue,
      previousValue
    ];
  }

  /**
   * Формує повний баланс (Форма №1)
   * @returns {Array} - двомірний масив з усіма рядками балансу
   */
  getBalance() {
    const balanceRows = [
      // АКТИВ
      // I. Необоротні активи
      1000, 1001, 1002, 1005, 1010, 1011, 1012, 1015, 1020,
      1030, 1035, 1040, 1045, 1090, 1095,
      
      // II. Оборотні активи
      1100, 1110, 1125, 1130, 1135, 1136, 1155, 1160, 1165,
      1170, 1190, 1195,
      
      // III. Необоротні активи, утримувані для продажу
      1200,
      
      // Баланс
      1300,
      
      // ПАСИВ
      // I. Власний капітал
      1400, 1405, 1410, 1415, 1420, 1425, 1430, 1495,
      
      // II. Довгострокові зобов'язання і забезпечення
      1500, 1510, 1515, 1520, 1525, 1595,
      
      // III. Поточні зобов'язання
      1600, 1610, 1615, 1620, 1621, 1625, 1630, 1660, 1665, 1690, 1695,
      
      // IV. Зобов'язання, пов'язані з необоротними активами
      1700,
      
      // Баланс
      1900
    ];

    return balanceRows.map(code => this.formatRow(code));
  }

  /**
   * Формує скорочений баланс (тільки підсумкові рядки)
   * @returns {Array} - двомірний масив зі скороченим балансом
   */
  getShortBalance() {
    const shortBalanceStructure = [
      // АКТИВ
      { label: "I.", name: "Необоротні активи", code: 1095 },
      { label: "II.", name: "Оборотні активи", code: 1195 },
      { label: "III.", name: "Необоротні активи, утримувані для продажу, та групи вибуття", code: 1200 },
      { label: "", name: "БАЛАНС", code: 1300 },
      
      // ПАСИВ
      { label: "I.", name: "Власний капітал", code: 1495 },
      { label: "II.", name: "Довгострокові зобов'язання і забезпечення", code: 1595 },
      { label: "III.", name: "Поточні зобов'язання і забезпечення", code: 1695 },
      { label: "IV.", name: "Зобов'язання, пов'язані з необоротними активами, утримуваними для продажу, та групами вибуття", code: 1700 },
      { label: "", name: "БАЛАНС", code: 1900 }
    ];

    return shortBalanceStructure.map(item => {
      const currentValue = this.getValue(item.code, 3);
      const previousValue = this.getValue(item.code, 4);
      
      return [
        item.label,
        `${item.name}(${item.code})`,
        currentValue,
        previousValue
      ];
    });
  }

  /**
   * Формує скорочений баланс з групуванням за розділами
   * @returns {Object} - об'єкт з розділами балансу
   */
  getShortBalanceGrouped() {
    const shortBalance = this.getShortBalance();
    
    return {
      АКТИВ: shortBalance.slice(0, 4),  // Перші 4 рядки - актив
      ПАСИВ: shortBalance.slice(4)       // Решта - пасив
    };
  }

  /**
   * Формує звіт про фінансові результати (Форма №2)
   * @returns {Array} - двомірний масив з усіма рядками звіту
   */
  getIncomeStatement() {
    const incomeRows = [
      // I. ФІНАНСОВІ РЕЗУЛЬТАТИ
      2000, 2050, 2090, 2095, 2120, 2130, 2150, 2180,
      2190, 2195, 2200, 2220, 2240, 2250, 2255, 2270,
      2290, 2295, 2300, 2305, 2350, 2355,
      
      // II. СУКУПНИЙ ДОХІД
      2400, 2405, 2410, 2415, 2445, 2450, 2455, 2460, 2465,
      
      // III. ЕЛЕМЕНТИ ОПЕРАЦІЙНИХ ВИТРАТ
      2500, 2505, 2510, 2515, 2520, 2550,
      
      // IV. РОЗРАХУНОК ПОКАЗНИКІВ ПРИБУТКОВОСТІ АКЦІЙ
      2600, 2605, 2610, 2615, 2650
    ];

    return incomeRows.map(code => this.formatRow(code));
  }

  /**
   * Формує комбінований звіт (Баланс + Звіт про фінансові результати)
   * @returns {Array} - двомірний масив з усіма рядками
   */
  getFullReport() {
    return [
      ...this.getBalance(),
      ...this.getIncomeStatement()
    ];
  }

  /**
   * Фільтрує рядки, які мають ненульові значення
   * @param {Array} report - звіт для фільтрації
   * @returns {Array} - відфільтрований звіт
   */
  filterNonZeroRows(report) {
    // Для скороченого балансу індекси 2 і 3
    // Для повного балансу теж індекси 2 і 3
    const currentIdx = 2;
    const previousIdx = 3;
    
    return report.filter(row => row[currentIdx] !== 0 || row[previousIdx] !== 0);
  }

  /**
   * Експортує у CSV формат
   * @param {Array} report - звіт для експорту
   * @returns {string} - CSV рядок
   */
  toCSV(report) {
    const header = "Розділ,Назва,Поточний період,Попередній період\n";
    const rows = report.map(row => row.map(cell => `"${cell}"`).join(",")).join("\n");
    return header + rows;
  }

  /**
   * Експортує у JSON формат
   * @param {Array} report - звіт для експорту
   * @param {boolean} isShortFormat - чи це скорочений формат
   * @returns {string} - JSON рядок
   */
  toJSON(report, isShortFormat = false) {
    const formatted = report.map(row => {
      if (isShortFormat) {
        return {
          section: row[0],
          name: row[1],
          current: row[2],
          previous: row[3]
        };
      } else {
        return {
          code: row[0],
          name: row[1],
          current: row[2],
          previous: row[3]
        };
      }
    });
    return JSON.stringify(formatted, null, 2);
  }
}

// Приклад використання
const financialData = {
  "FС": "S0100115",
  "R1000G3": 0, "R1000G4": 0,
  "R1010G3": 132502, "R1010G4": 130785,
  "R1011G3": 194118, "R1011G4": 206619,
  "R1012G3": 61616, "R1012G4": 75834,
  "R1095G3": 148365, "R1095G4": 150255,
  "R1100G3": 122105, "R1100G4": 158633,
  "R1125G3": 43980, "R1125G4": 20906,
  "R1165G3": 29006, "R1165G4": 46832,
  "R1195G3": 200552, "R1195G4": 238003,
  "R1200G3": 0, "R1200G4": 0,
  "R1300G3": 348917, "R1300G4": 388258,
  "R1400G3": 95873, "R1400G4": 95873,
  "R1420G3": 114694, "R1420G4": 152381,
  "R1495G3": 210799, "R1495G4": 254824,
  "R1595G3": 968, "R1595G4": 0,
  "R1600G3": 45548, "R1600G4": 46100,
  "R1615G3": 56881, "R1615G4": 52340,
  "R1695G3": 137150, "R1695G4": 133434,
  "R1700G3": 0, "R1700G4": 0,
  "R1900G3": 348917, "R1900G4": 388258,
  "R2000G3": 303875, "R2000G4": 300205,
  "R2050G3": 225477, "R2050G4": 222774,
  "R2090G3": 78398, "R2090G4": 77431,
  "R2290G3": 45960, "R2290G4": 39249,
  "R2350G3": 37687, "R2350G4": 32184
};



const formatter = new BalanceFormatter(financialData);

// Отримати повний баланс
console.log("=== ПОВНИЙ БАЛАНС ===");
const balance = formatter.getBalance();
console.log(balance.slice(0, 5)); // Перші 5 рядків

// Отримати скорочений баланс
console.log("\n=== СКОРОЧЕНИЙ БАЛАНС ===");
const shortBalance = formatter.getShortBalance();
console.log(shortBalance);
/*
Очікуваний результат:
[
  ["I.", "Необоротні активи(1095)", 148365, 150255],
  ["II.", "Оборотні активи(1195)", 200552, 238003],
  ["III.", "Необоротні активи, утримувані для продажу, та групи вибуття(1200)", 0, 0],
  ["", "БАЛАНС(1300)", 348917, 388258],
  ["I.", "Власний капітал(1495)", 210799, 254824],
  ["II.", "Довгострокові зобов'язання і забезпечення(1595)", 968, 0],
  ["III.", "Поточні зобов'язання і забезпечення(1695)", 137150, 133434],
  ["IV.", "Зобов'язання, пов'язані з необоротними активами, утримуваними для продажу, та групами вибуття(1700)", 0, 0],
  ["", "БАЛАНС(1900)", 348917, 388258]
]
*/

// Отримати скорочений баланс згрупований
console.log("\n=== СКОРОЧЕНИЙ БАЛАНС (ЗГРУПОВАНИЙ) ===");
const groupedBalance = formatter.getShortBalanceGrouped();
console.log("АКТИВ:", groupedBalance.АКТИВ);
console.log("ПАСИВ:", groupedBalance.ПАСИВ);

// Отримати звіт про фінансові результати
console.log("\n=== ЗВІТ ПРО ФІНАНСОВІ РЕЗУЛЬТАТИ ===");
const income = formatter.getIncomeStatement();
console.log(income.slice(0, 5)); // Перші 5 рядків

// Отримати тільки ненульові рядки
console.log("\n=== НЕНУЛЬОВІ РЯДКИ СКОРОЧЕНОГО БАЛАНСУ ===");
const nonZeroShortBalance = formatter.filterNonZeroRows(shortBalance);
console.log(nonZeroShortBalance);

// Експорт скороченого балансу у CSV
console.log("\n=== CSV ФОРМАТ (СКОРОЧЕНИЙ БАЛАНС) ===");
console.log(formatter.toCSV(shortBalance));

// Експорт у JSON
console.log("\n=== JSON ФОРМАТ (СКОРОЧЕНИЙ БАЛАНС) ===");
console.log(formatter.toJSON(shortBalance, true));